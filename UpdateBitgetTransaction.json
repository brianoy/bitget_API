{"files":[{"id":"194cb2a2-5c78-4a6a-840a-2b1e2b013345","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"64a4f70e-b941-4a30-aff4-220f7c5b231b","name":"UpdateBitgetTransaction","type":"server_js","source":"function bitget_all_data(apikey,secretkey,passphrase,start,end,detail \u003d []) {\n //var apikey \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B2\u0027).getValue();\n //var secretkey \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B3\u0027).getValue();\n //var passphrase \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B4\u0027).getValue();\n var counter \u003d 0\n var method \u003d \u0027GET\u0027\n var requestPath \u003d \"/api/mix/v1/order/fills\"\n var url \u003d \"https://api.bitget.com\"\n var date \u003d new Date();\n Logger.log(time)\n detail.push([\n              \"Unix時間(GMT+0)\",\n              \"開/關倉(皆為關倉)\",\n              \"交易對\",\n              \"價格\",\n              \"數量\",\n              \"手續費\",\n              \"orderId\"\n            ]);\n var midtime \u003d 0;\n for (start; start \u003c end; start \u003d start + 86400000) {\n   midtime \u003d start + 86400000\n   var time \u003d Math.floor((date.getTime())).toString();\n   var queryString \u003d \"symbol\u003dBTCUSDT_UMCBL\u0026startTime\u003d\" + start +\"\u0026endTime\u003d\" + midtime//注意時間是毫秒\n   var unsign \u003d (time + method + requestPath + \"?\" + queryString);\n   Logger.log(unsign)\n   var signed_sha256 \u003d Utilities.computeHmacSha256Signature(unsign,secretkey);\n   var blob \u003d Utilities.newBlob(signed_sha256);\n   var signed_sha256_base64 \u003d Utilities.base64Encode(blob.getBytes());\n   var options \u003d {\n     \u0027headers\u0027: {\n      \u0027ACCESS-KEY\u0027 : apikey,\n      \u0027ACCESS-SIGN\u0027 : signed_sha256_base64,\n      \u0027ACCESS-TIMESTAMP\u0027 : time,\n      \u0027ACCESS-PASSPHRASE\u0027 : passphrase,\n      \u0027Content-Type\u0027 : \u0027application/json\u0027,\n      \u0027locale\u0027 : \u0027zh-CN\u0027\n     }\n   };\n   data \u003d UrlFetchApp.fetch(url + requestPath + \"?\" +queryString ,options);\n   Logger.log(data);\n   var json \u003d JSON.parse(data);\n   //Logger.log(json);\n   for(var nData in json.data){\n     //if(json.data[nData].side \u003d\u003d \"close_long\"||json.data[nData].side \u003d\u003d \"close_short\"){\n            detail.push([\n              json.data[nData].cTime,\n              json.data[nData].side,\n              json.data[nData].symbol,\n              json.data[nData].price,\n              json.data[nData].sizeQty,\n              json.data[nData].fee,\n              json.data[nData].orderId\n            ]);\n          counter++\n       //}\n   }\n   Logger.log(start);\n   Logger.log(counter);\n  }\n   var time \u003d Math.floor((date.getTime())).toString();\n   var queryString \u003d \"symbol\u003dBTCUSDT_UMCBL\u0026startTime\u003d\" + start +\"\u0026endTime\u003d\" + end//注意時間是毫秒\n   var unsign \u003d (time + method + requestPath + \"?\" + queryString);\n   var signed_sha256 \u003d Utilities.computeHmacSha256Signature(unsign,secretkey);\n   var blob \u003d Utilities.newBlob(signed_sha256);\n   var signed_sha256_base64 \u003d Utilities.base64Encode(blob.getBytes());\n   var options \u003d {\n     \u0027headers\u0027: {\n      \u0027ACCESS-KEY\u0027 : apikey,\n      \u0027ACCESS-SIGN\u0027 : signed_sha256_base64,\n      \u0027ACCESS-TIMESTAMP\u0027 : time,\n      \u0027ACCESS-PASSPHRASE\u0027 : passphrase,\n      \u0027Content-Type\u0027 : \u0027application/json\u0027,\n      \u0027locale\u0027 : \u0027zh-CN\u0027\n     }\n   };\n   data \u003d UrlFetchApp.fetch(url + requestPath + \"?\" +queryString ,options);\n   //Logger.log(data);\n   json \u003d JSON.parse(data);\n   //Logger.log(json);\n   for(var nData in json.data){\n     //if(json.data[nData].side \u003d\u003d \"close_long\"||json.data[nData].side \u003d\u003d \"close_short\"){\n            detail.push([\n              json.data[nData].cTime,\n              json.data[nData].side,\n              json.data[nData].symbol,\n              json.data[nData].price,\n              json.data[nData].sizeQty,\n              json.data[nData].fee,\n              json.data[nData].orderId\n            ]);\n          counter++\n       //}\n   }\n  return detail\n}\n\n"},{"id":"3e4935af-ccb9-48f5-a10d-20ddefa94f61","name":"UpdateBitgetOrderDetail","type":"server_js","source":"function bitget_order_detail(apikey,secretkey,passphrase,orderid,status,detail \u003d []) {\n //var apikey \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B2\u0027).getValue();\n //var secretkey \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B3\u0027).getValue();\n //var passphrase \u003d SpreadsheetApp.getActive().getSheetByName(\u0027bitget設定\u0027).getRange(\u0027B4\u0027).getValue();\n var method \u003d \u0027GET\u0027\n var requestPath \u003d \"/api/mix/v1/order/detail\"\n var url \u003d \"https://api.bitget.com\"\n var queryString \u003d \"symbol\u003dBTCUSDT_UMCBL\u0026orderId\u003d\"+ orderid\n var date \u003d new Date();\n var time \u003d Math.floor((date.getTime())).toString();\n\n  Logger.log(time)\n var unsign \u003d (time + method + requestPath + \"?\" + queryString);\n  Logger.log(unsign)\n var signed_sha256 \u003d Utilities.computeHmacSha256Signature(unsign,secretkey);\n var blob \u003d Utilities.newBlob(signed_sha256);\n var signed_sha256_base64 \u003d Utilities.base64Encode(blob.getBytes());\n var options \u003d {\n     \u0027headers\u0027: {\n      \u0027ACCESS-KEY\u0027 : apikey,\n      \u0027ACCESS-SIGN\u0027 : signed_sha256_base64,\n      \u0027ACCESS-TIMESTAMP\u0027 : time,\n      \u0027ACCESS-PASSPHRASE\u0027 : passphrase,\n      \u0027Content-Type\u0027 : \u0027application/json\u0027,\n      \u0027locale\u0027 : \u0027zh-CN\u0027\n     }\n   };\n   if(status \u003d\u003d \"close_long\" || status \u003d\u003d \"close_short\"){\n    data \u003d UrlFetchApp.fetch(url + requestPath + \"?\" +queryString ,options);\n    var json \u003d JSON.parse(data);\n    detail \u003d json.data.totalProfits\n    Utilities.sleep(Math.floor(Math.random() * (4000 - 100 + 1)) + 100);\n    }\n   else{\n    detail \u003d \"無資料\"\n    }\n return detail\n}"}]}